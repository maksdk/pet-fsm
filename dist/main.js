!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};Object.defineProperty(e,"__esModule",{value:!0}),e.FSM=e.StateNode=void 0;var a=function(t){return t[t.length-1]},c=function(){function t(t,e){this.fsm=t,this.parent=e}return t.prototype.onPrepare=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},t.prototype.onEnter=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},t.prototype.onExit=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},t.prototype.onUpdate=function(t){},t}();e.StateNode=c;var u=function(){function t(t,e){if(this.states=e,this._transactionsSequence=[],this._isSentWarnings=!1,this._isStopped=!1,this._isStarted=!1,this._graph={},this._leafsStack=[],this._currentOrder=-1,this._statesStack=[],0===Object.keys(t).length)throw console.error('Is not valid config: "'+t+'"'),new Error;this._checkMachineConfig(t),this._graph=this._makeGraph(t)}return t.prototype.onStart=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._isStopped||this._isStarted?[2]:(this._isStarted=!0,this._enterToStateById("Root"),[4,this._executeTransition()]);case 1:return t.sent(),[2]}}))}))},t.prototype.onStop=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){return this._isStopped?[2]:this._isStarted?(this._isStopped=!0,this._graph={},this._leafsStack=[],this._currentOrder=-1,t=this._statesStack.map((function(t){return t.state.onExit()})),this._statesStack=[],[2,Promise.all(t)]):[2]}))}))},t.prototype.onSend=function(t){this._isStopped||this._isStarted&&(this._checkAmongAllEvent(this._graph,t)?this._checkEventInStack(t)?(0===this._transactionsSequence.length&&this._nextTransation(t),this._transactionsSequence.push(t)):this._warn('Event: "'+t+'" is not found in the current state tree'):this._warn('Event: "'+t+'" is not registered in the machine'))},t.prototype.onUpdate=function(t){this._statesStack.forEach((function(e){var n=e.state;return e.running&&n.onUpdate(t)}))},t.prototype.getCurrentStateId=function(){return this._isStarted?this._isStopped?(this._warn("Machine is already stopped !!!"),""):a(this._statesStack).state.id:(this._warn("Machine is not started yet !!!"),"")},t.prototype.getCurrentState=function(){return this._isStarted?this._isStopped?(this._warn("Machine is already stopped !!!"),null):a(this._statesStack).state:(this._warn("Machine is not started yet !!!"),null)},t.prototype._nextTransation=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this._exitFromStateByEvent(t),[4,this._executeTransition()];case 1:return e.sent(),[2]}}))}))},t.prototype._executeTransition=function(){return i(this,void 0,void 0,(function(){var t,e,n,r,i,s;return o(this,(function(c){switch(c.label){case 0:t=[],e=function(e){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return r=n._statesStack[e],i=r.state,s=r.order,a=i.id,n._leafsStack.find((function(t){return t.stateId===a&&t.order===s}))?[3,2]:[4,i.onExit()];case 1:return o.sent(),n._statesStack[e].running=!1,[3,3];case 2:t.push({state:i,order:s,running:!0}),o.label=3;case 3:return[2]}}))},n=this,s=this._statesStack.length-1,c.label=1;case 1:return s>=0?[5,e(s)]:[3,4];case 2:c.sent(),c.label=3;case 3:return s-=1,[3,1];case 4:r=function(e){var n,r,s,c;return o(this,(function(o){switch(o.label){case 0:if(n=i._leafsStack[e],t.find((function(t){return t.state.id===n.stateId&&t.order===n.order})))return[3,3];if(!i.states.has(n.stateId))throw new Error('State with id: "'+n.stateId+'" is not found');if(!(r=i.states.get(n.stateId)))throw new Error('State with id: "'+n.stateId+'" is not found');return s=a(t),[4,(c=new r(i,s?s.state:null)).onPrepare()];case 1:return o.sent(),t.push({state:c,order:n.order,running:!0}),[4,c.onEnter()];case 2:o.sent(),o.label=3;case 3:return[2]}}))},i=this,s=1,c.label=5;case 5:return s<this._leafsStack.length?[5,r(s)]:[3,8];case 6:c.sent(),c.label=7;case 7:return s+=1,[3,5];case 8:return this._statesStack=t,this._transactionsSequence.shift(),this._transactionsSequence.length>0&&this._nextTransation(this._transactionsSequence[0]),[2]}}))}))},t.prototype._makeGraph=function(t){var e=function(t,n,i,o){var a,c;void 0===i&&(i={}),void 0===o&&(o=[]);var u=s(o,[n]).join(".");return t.states?r(r(r({},i),((c={})[u]={stateId:n,transitions:t.on||{},uniqueId:u,initial:t.initial},c)),Object.entries(t.states).reduce((function(t,a){var c=a[0],u=a[1];return r(r({},t),e(u,c,i,s(o,[n])))}),{})):r(r({},i),((a={})[u]={stateId:n,transitions:t.on||{},uniqueId:u},a))};return e(t,"Root",{},[])},t.prototype._exitFromStateByEvent=function(t){var e=this._leafsStack.pop();if(e)if(e.transitions.hasOwnProperty(t)){var n=this._getNextStateUniqueIdByEvent(e,t);this._enterToStateById(n)}else this._exitFromStateByEvent(t)},t.prototype._enterToStateById=function(t){if(!this._graph.hasOwnProperty(t))throw console.error('Such state id: "'+t+'" is not found in the graph: ',this._graph),new Error;this._currentOrder+=1,this._leafsStack.push(r({order:this._currentOrder},this._graph[t])),this._graph[t].initial&&this._enterToStateById(t+"."+this._graph[t].initial)},t.prototype._getNextStateUniqueIdByEvent=function(t,e){return this._getParentUniqueId(t)+"."+t.transitions[e]},t.prototype._getParentUniqueId=function(t){var e=t.uniqueId.split("."),n=e.slice(0,e.length-1);return 0===n.length?"Root":n.join(".")},t.prototype._checkAmongAllEvent=function(t,e){return Object.values(t).filter((function(t){return!!t.transitions.hasOwnProperty(e)})).length>0},t.prototype._checkEventInStack=function(t){var e=function(n,r){return!!r[n]&&(!!r[n].transitions.hasOwnProperty(t)||e(n-=1,r))};return e(this._leafsStack.length-1,this._leafsStack)},t.prototype._checkMachineConfig=function(t){var e=this;this._checkConfig(t),this._checkTransions(t.states||{}),t.states&&(this._checkStatesList(t.states),Object.values(t.states).forEach((function(t){return e._checkMachineConfig(t)})))},t.prototype._checkStatesList=function(t){var e=this;return Object.keys(t).forEach((function(t){if(!e.states.has(t))throw console.error('Such state: "'+t+'" is not found in states list !!!'),new Error})),!0},t.prototype._checkConfig=function(t){if("object"!=typeof t)throw console.error("Invalid config: ",t),new Error;var e=t.hasOwnProperty("states")&&"object"==typeof t.states,n=t.hasOwnProperty("initial")&&"string"==typeof t.initial;if(e&&n&&t.states&&t.initial){if(!t.states.hasOwnProperty(t.initial))throw console.error('Such an initial state: "'+t.initial+" is not found in state config: ",t.states),new Error;return!0}if(!e&&!n)return!0;throw console.error("Invalid properties of state config: ",t),new Error},t.prototype._checkTransions=function(t){for(var e in t){var n=t[e].on,r=void 0===n?{}:n;for(var i in r){var o=r[i];if(!t.hasOwnProperty(o))throw console.error('Such state: "'+o+'" is not exist in such list: ',t),new Error}}return!0},t.prototype._warn=function(t,e){void 0===e&&(e=""),this._isSentWarnings&&console.warn(t,e)},t}();e.FSM=u}]);